/*
 * Fuel UX Wizard
 * https://github.com/ExactTarget/fuelux
 *
 * Copyright (c) 2014 ExactTarget
 * Licensed under the BSD New license.
 */(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof exports?module.exports=c(require("jquery")):c(jQuery)})(function(c){var p=c.fn.wizard,m=function(a,d){this.$element=c(a);this.options=c.extend({},c.fn.wizard.defaults,d);this.options.disablePreviousStep="previous"===this.$element.attr("data-restrict")?!0:this.options.disablePreviousStep;this.currentStep=this.options.selectedItem.step;this.numSteps=this.$element.find(".steps li").length;this.$prevBtn=this.$element.find("button.btn-prev");this.$nextBtn=this.$element.find("button.btn-next");var b=this.$nextBtn.children().detach();this.nextText=c.trim(this.$nextBtn.text());this.$nextBtn.append(b);b=this.$element.children(".steps-container");0===b.length&&(b=this.$element,this.$element.addClass("no-steps-container"),window&&window.console&&window.console.warn&&window.console.warn('please update your wizard markup to include ".steps-container" as seen in http://getfuelux.com/javascript.html#wizard-usage-markup'));b=b.find(".steps");this.$prevBtn.on("click.fu.wizard",c.proxy(this.previous,this));this.$nextBtn.on("click.fu.wizard",c.proxy(this.next,this));b.on("click.fu.wizard","li.complete",c.proxy(this.stepclicked,this));this.selectedItem(this.options.selectedItem);this.options.disablePreviousStep&&(this.$prevBtn.attr("disabled",!0),this.$element.find(".steps").addClass("previous-disabled"))};m.prototype={constructor:m,destroy:function(){this.$element.remove();return this.$element[0].outerHTML},addSteps:function(a){var d=[].slice.call(arguments).slice(1),b=this.$element.find(".steps"),f=this.$element.find(".step-content"),e,h,g,n,k,l;a=-1===a||a>this.numSteps+1?this.numSteps+1:a;d[0]instanceof Array&&(d=d[0]);k=b.find("li:nth-child("+a+")");n=f.find(".step-pane:nth-child("+a+")");1>k.length&&(k=null);e=0;for(h=d.length;e<h;e++)l=c('\x3cli data-step\x3d"'+a+'"\x3e\x3cspan class\x3d"badge badge-info"\x3e\x3c/span\x3e\x3c/li\x3e'),l.append(d[e].label||"").append('\x3cspan class\x3d"chevron"\x3e\x3c/span\x3e'),l.find(".badge").append(d[e].badge||a),g=c('\x3cdiv class\x3d"step-pane" data-step\x3d"'+a+'"\x3e\x3c/div\x3e'),g.append(d[e].pane||""),k?(k.before(l),n.before(g)):(b.append(l),f.append(g)),a++;this.syncSteps();this.numSteps=b.find("li").length;this.setState()},removeSteps:function(a,d){var b="nextAll",f=0,e=this.$element.find(".steps"),h=this.$element.find(".step-content"),g;d=void 0!==d?d:1;a>e.find("li").length?g=e.find("li:last"):(g=e.find("li:nth-child("+a+")").prev(),1>g.length&&(b="children",g=e));g[b]().each(function(){var a=c(this),b=a.attr("data-step");if(f<d)a.remove(),h.find('.step-pane[data-step\x3d"'+b+'"]:first').remove();else return!1;f++});this.syncSteps();this.numSteps=e.find("li").length;this.setState()},setState:function(){var a=1<this.currentStep,d=1===this.currentStep,b=this.currentStep===this.numSteps;this.options.disablePreviousStep||this.$prevBtn.attr("disabled",!0===d||!1===a);if(a=this.$nextBtn.attr("data-last"))this.lastText=a,a=this.nextText,!0===b?(a=this.lastText,this.$element.addClass("complete")):this.$element.removeClass("complete"),b=this.$nextBtn.children().detach(),this.$nextBtn.text(a).append(b);b=this.$element.find(".steps li");b.removeClass("active").removeClass("complete");b.find("span.badge").removeClass("badge-info").removeClass("badge-success");b=this.$element.find(".steps li:lt("+(this.currentStep-1)+")");b.addClass("complete");b.find("span.badge").addClass("badge-success");a=this.$element.find(".steps li:eq("+(this.currentStep-1)+")");a.addClass("active");a.find("span.badge").addClass("badge-info");b=this.$element.find(".step-content");a=a.attr("data-step");b.find(".step-pane").removeClass("active");b.find('.step-pane[data-step\x3d"'+a+'"]:first').addClass("active");this.$element.find(".steps").first().attr("style","margin-left: 0");var f=0;this.$element.find(".steps \x3e li").each(function(){f+=c(this).outerWidth()});b=0;b=this.$element.find(".actions").length?this.$element.width()-this.$element.find(".actions").first().outerWidth():this.$element.width();f>b&&(b=f-b,this.$element.find(".steps").first().attr("style","margin-left: -"+b+"px"),200>this.$element.find("li.active").first().position().left&&(b+=this.$element.find("li.active").first().position().left-200,1>b?this.$element.find(".steps").first().attr("style","margin-left: 0"):this.$element.find(".steps").first().attr("style","margin-left: -"+b+"px")));"undefined"!==typeof this.initialized&&(b=c.Event("changed.fu.wizard"),this.$element.trigger(b,{step:this.currentStep}));this.initialized=!0},stepclicked:function(a){a=c(a.currentTarget);a=this.$element.find(".steps li").index(a);if(!(a<this.currentStep&&this.options.disablePreviousStep)){var d=c.Event("stepclicked.fu.wizard");this.$element.trigger(d,{step:a+1});d.isDefaultPrevented()||(this.currentStep=a+1,this.setState())}},syncSteps:function(){var a=1,d=this.$element.find(".steps"),b=this.$element.find(".step-content");d.children().each(function(){var d=c(this),e=d.find(".badge"),h=d.attr("data-step");isNaN(parseInt(e.html(),10))||e.html(a);d.attr("data-step",a);b.find('.step-pane[data-step\x3d"'+h+'"]:last').attr("data-step",a);a++})},previous:function(){if(!this.options.disablePreviousStep&&1!==this.currentStep){var a=c.Event("actionclicked.fu.wizard");this.$element.trigger(a,{step:this.currentStep,direction:"previous"});a.isDefaultPrevented()||(--this.currentStep,this.setState(),this.$prevBtn.is(":focus")&&(a=this.$element.find(".active").find("input, select, textarea")[0],"undefined"!==typeof a?c(a).focus():0===this.$element.find(".active input:first").length&&this.$prevBtn.is(":disabled")&&this.$nextBtn.focus()))}},next:function(){var a=c.Event("actionclicked.fu.wizard");this.$element.trigger(a,{step:this.currentStep,direction:"next"});a.isDefaultPrevented()||(this.currentStep<this.numSteps?(this.currentStep+=1,this.setState()):this.$element.trigger("finished.fu.wizard"),this.$nextBtn.is(":focus")&&(a=this.$element.find(".active").find("input, select, textarea")[0],"undefined"!==typeof a?c(a).focus():0===this.$element.find(".active input:first").length&&this.$nextBtn.is(":disabled")&&this.$prevBtn.focus()))},selectedItem:function(a){a?(a=a.step||-1,a=Number(this.$element.find('.steps li[data-name\x3d"'+a+'"]').first().attr("data-step"))||Number(a),1<=a&&a<=this.numSteps?(this.currentStep=a,this.setState()):(a=this.$element.find(".steps li.active:first").attr("data-step"),isNaN(a)||(this.currentStep=parseInt(a,10),this.setState())),a=this):(a={step:this.currentStep},this.$element.find(".steps li.active:first[data-name]").length&&(a.stepname=this.$element.find(".steps li.active:first").attr("data-name")));return a}};c.fn.wizard=function(a){var d=Array.prototype.slice.call(arguments,1),b,f=this.each(function(){var e=c(this),f=e.data("fu.wizard"),g="object"===typeof a&&a;f||e.data("fu.wizard",f=new m(this,g));"string"===typeof a&&(b=f[a].apply(f,d))});return void 0===b?f:b};c.fn.wizard.defaults={disablePreviousStep:!1,selectedItem:{step:-1}};c.fn.wizard.Constructor=m;c.fn.wizard.noConflict=function(){c.fn.wizard=p;return this};c(document).on("mouseover.fu.wizard.data-api","[data-initialize\x3dwizard]",function(a){a=c(a.target).closest(".wizard");a.data("fu.wizard")||a.wizard(a.data())});c(function(){c("[data-initialize\x3dwizard]").each(function(){var a=c(this);a.data("fu.wizard")||a.wizard(a.data())})})});