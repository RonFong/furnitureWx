/*
 * Fuel UX Spinbox
 * https://github.com/ExactTarget/fuelux
 *
 * Copyright (c) 2014 ExactTarget
 * Licensed under the BSD New license.
 */(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):"object"===typeof exports?module.exports=b(require("jquery")):b(jQuery)})(function(b){var k=b.fn.spinbox,g=function(a,d){this.$element=b(a);this.$element.find(".btn").on("click",function(a){a.preventDefault()});this.options=b.extend({},b.fn.spinbox.defaults,d);this.options.step=this.$element.data("step")||this.options.step;this.options.value<this.options.min?this.options.value=this.options.min:this.options.max<this.options.value&&(this.options.value=this.options.max);this.$input=this.$element.find(".spinbox-input");this.$input.on("focusout.fu.spinbox",this.$input,b.proxy(this.change,this));this.$element.on("keydown.fu.spinbox",this.$input,b.proxy(this.keydown,this));this.$element.on("keyup.fu.spinbox",this.$input,b.proxy(this.keyup,this));this.options.hold?(this.$element.on("mousedown.fu.spinbox",".spinbox-up",b.proxy(function(){this.startSpin(!0)},this)),this.$element.on("mouseup.fu.spinbox",".spinbox-up, .spinbox-down",b.proxy(this.stopSpin,this)),this.$element.on("mouseout.fu.spinbox",".spinbox-up, .spinbox-down",b.proxy(this.stopSpin,this)),this.$element.on("mousedown.fu.spinbox",".spinbox-down",b.proxy(function(){this.startSpin(!1)},this))):(this.$element.on("click.fu.spinbox",".spinbox-up",b.proxy(function(){this.step(!0)},this)),this.$element.on("click.fu.spinbox",".spinbox-down",b.proxy(function(){this.step(!1)},this)));this.switches={count:1,enabled:!0};this.switches.speed="medium"===this.options.speed?300:"fast"===this.options.speed?100:500;this.options.defaultUnit=f(this.options.defaultUnit,this.options.units)?this.options.defaultUnit:"";this.unit=this.options.defaultUnit;this.lastValue=this.options.value;this.render();this.options.disabled&&this.disable()},f=function(a,d){var c=!1,e=a.toLowerCase();b.each(d,function(a,b){b=b.toLowerCase();if(e===b)return c=!0,!1});return c};g.prototype={constructor:g,destroy:function(){this.$element.remove();this.$element.find("input").each(function(){b(this).attr("value",b(this).val())});return this.$element[0].outerHTML},render:function(){this._setValue(this.getDisplayValue())},change:function(){this._setValue(this.getDisplayValue());this.triggerChangedEvent()},stopSpin:function(){void 0!==this.switches.timeout&&(clearTimeout(this.switches.timeout),this.switches.count=1,this.triggerChangedEvent())},triggerChangedEvent:function(){var a=this.getValue();a!==this.lastValue&&(this.lastValue=a,this.$element.trigger("changed.fu.spinbox",a))},startSpin:function(a){if(!this.options.disabled){var d=this.switches.count;1===d?(this.step(a),d=1):d=3>d?1.5:8>d?2.5:4;this.switches.timeout=setTimeout(b.proxy(function(){this.iterate(a)},this),this.switches.speed/d);this.switches.count++}},iterate:function(a){this.step(a);this.startSpin(a)},step:function(a){this._setValue(this.getDisplayValue());a=a?this.options.value+this.options.step:this.options.value-this.options.step;a=a.toFixed(5);this._setValue(a+this.unit)},getDisplayValue:function(){var a=this.parseInput(this.$input.val());return a?a:this.options.value},setDisplayValue:function(a){this.$input.val(a)},getValue:function(){var a=this.options.value;"."!==this.options.decimalMark&&(a=(a+"").split(".").join(this.options.decimalMark));return a+this.unit},setValue:function(a){return this._setValue(a,!0)},_setValue:function(a,b){"."!==this.options.decimalMark&&(a=this.parseInput(a));if("number"!==typeof a){var c=a.replace(/[0-9.-]/g,"");this.unit=f(c,this.options.units)?c:this.options.defaultUnit}c=this.getIntValue(a);if(isNaN(c)&&!isFinite(c))return this._setValue(this.options.value,b);if(!isNaN(parseFloat(c))&&(c>this.options.max?c=this.options.cycle?this.options.min:this.options.max:c<this.options.min&&(c=this.options.cycle?this.options.max:this.options.min),this.options.limitToStep&&this.options.step)){var d=this.options.step,c=Math.round(c/d)*d;c>this.options.max?c-=this.options.step:c<this.options.min&&(c+=this.options.step)}this.options.value=c;a=c+this.unit;"."!==this.options.decimalMark&&(a=(a+"").split(".").join(this.options.decimalMark));this.setDisplayValue(a);b&&(this.lastValue=a);return this},value:function(a){return a||0===a?this.setValue(a):this.getValue()},parseInput:function(a){return a=(a+"").split(this.options.decimalMark).join(".")},getIntValue:function(a){a="undefined"===typeof a?this.getValue():a;if("undefined"!==typeof a)return"string"===typeof a&&(a=this.parseInput(a)),a=parseFloat(a,10)},disable:function(){this.options.disabled=!0;this.$element.addClass("disabled");this.$input.attr("disabled","");this.$element.find("button").addClass("disabled")},enable:function(){this.options.disabled=!1;this.$element.removeClass("disabled");this.$input.removeAttr("disabled");this.$element.find("button").removeClass("disabled")},keydown:function(a){a=a.keyCode;38===a?this.step(!0):40===a?this.step(!1):13===a&&this.change()},keyup:function(a){a=a.keyCode;38!==a&&40!==a||this.triggerChangedEvent()}};b.fn.spinbox=function(a){var d=Array.prototype.slice.call(arguments,1),c,e=this.each(function(){var e=b(this),h=e.data("fu.spinbox"),f="object"===typeof a&&a;h||e.data("fu.spinbox",h=new g(this,f));"string"===typeof a&&(c=h[a].apply(h,d))});return void 0===c?e:c};b.fn.spinbox.defaults={value:0,min:0,max:999,step:1,hold:!0,speed:"medium",disabled:!1,cycle:!1,units:[],decimalMark:".",defaultUnit:"",limitToStep:!1};b.fn.spinbox.Constructor=g;b.fn.spinbox.noConflict=function(){b.fn.spinbox=k;return this};b(document).on("mousedown.fu.spinbox.data-api","[data-initialize\x3dspinbox]",function(a){a=b(a.target).closest(".spinbox");a.data("fu.spinbox")||a.spinbox(a.data())});b(function(){b("[data-initialize\x3dspinbox]").each(function(){var a=b(this);a.data("fu.spinbox")||a.spinbox(a.data())})})});